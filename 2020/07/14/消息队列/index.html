<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>中间件 | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="消息队列 关于消息中间件的理解和一些常用的mq的认知。">
<meta property="og:type" content="article">
<meta property="og:title" content="中间件">
<meta property="og:url" content="http://example.com/2020/07/14/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="消息队列 关于消息中间件的理解和一些常用的mq的认知。">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2020-07-14T02:25:21.601Z">
<meta property="article:modified_time" content="2020-07-19T09:38:57.632Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 5.2.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-消息队列" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/07/14/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/" class="article-date">
  <time datetime="2020-07-14T02:25:21.601Z" itemprop="datePublished">2020-07-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      中间件
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="消息队列"><a href="#消息队列" class="headerlink" title="消息队列"></a>消息队列</h1><blockquote>
<p>关于消息中间件的理解和一些常用的mq的认知。</p>
</blockquote>
<a id="more"></a>

<h3 id="消息队列-1"><a href="#消息队列-1" class="headerlink" title="消息队列"></a>消息队列</h3><p>消息队列就是存放消息的队列，所谓的消息就是一个一个的命令（磁盘IO、网络IO等），将这些命令放到一个队列中，遵循先进先出的队列定义，依次被取出来执行。</p>
<p>这样看似没什么意义，其实加了这层消息队列，可以解决很多问题。</p>
<p>一是消峰，比如电商有一个促销活动，那么在刚开始的时候一定会有大量的访问请求，如果不加以处理，就会瞬间打崩数据库，加了mq后，就可以将这些IO放到队列中，慢慢去执行。</p>
<p>二是异步，在上面的场景中，就算数据库承受住了，处理这么多的请求也肯定很耗时，给用户带来的体验也非常差，所以，可以认为消息发送到消息队列中就成功了，不必等待数据库访问请求真正完成，可以即时将消息返回给用户，优化了用户的体验。</p>
<h4 id="消息队列的两种工作模式"><a href="#消息队列的两种工作模式" class="headerlink" title="消息队列的两种工作模式"></a>消息队列的两种工作模式</h4><h5 id="点对点模式（一对一）："><a href="#点对点模式（一对一）：" class="headerlink" title="点对点模式（一对一）："></a>点对点模式（一对一）：</h5><p>一个消息队列为一个消费者服务，如果有多的消费者，就需要一个新的消息队列</p>
<h5 id="发布订阅模式（一对多）："><a href="#发布订阅模式（一对多）：" class="headerlink" title="发布订阅模式（一对多）："></a>发布订阅模式（一对多）：</h5><h6 id="主动拉取型："><a href="#主动拉取型：" class="headerlink" title="主动拉取型："></a>主动拉取型：</h6><p>由消费者维护一个长轮询，主动从消息队列中拉取信息。问题：可能存在无谓的轮询消耗</p>
<h6 id="队列推送型："><a href="#队列推送型：" class="headerlink" title="队列推送型："></a>队列推送型：</h6><p>当消费者订阅了某个消息队列后，由消息队列主动向消费者推送消息。问题：当推送速度和消费速度不一致时，会造成消息丢失和资源浪费</p>
<h3 id="常见消息队列"><a href="#常见消息队列" class="headerlink" title="常见消息队列"></a>常见消息队列</h3><h4 id="rocketmq"><a href="#rocketmq" class="headerlink" title="rocketmq"></a>rocketmq</h4><p>rocketmq有四个核心组件：</p>
<p><strong>prodecer</strong>：生产者，可以集群部署，发送消息到broker</p>
<p><strong>consumer：</strong>消费者，可以集群部署，从broker获得消息来消费，消费者类型有两种（见下）</p>
<p><strong>broker：</strong>消息服务器，部署方式有四种（见下），每个broker中存放多个topic，每个topic中拥有多个queue，消息最终就存放在queue中</p>
<p><strong>name server：</strong>名称服务器，无状态，可横向扩展，存放broker的元数据，每个broker初始化后都需要在name server中注册，并且维护了一个topic与broker的映射，生产者和消费者去访问broker之前都需要访问name server获得该消息所属topic所在的broker路由信息</p>
<h6 id="broker四种部署方式"><a href="#broker四种部署方式" class="headerlink" title="broker四种部署方式"></a>broker四种部署方式</h6><p><strong>单Master：</strong>部署简单，但是broker宕机，服务不可用，风险很大</p>
<p><strong>多Master：</strong>部署简单，但是其中一台broker宕机，该broker上的消息会丢失，恢复之前不可订阅，即时性受影响</p>
<p><strong>多Master多Salve（异步复制）：</strong>主从之间存在毫秒级的消息延迟，master宕机后可以继续从slave订阅，极端情况下会产生少量的数据丢失</p>
<p><strong>多Master多Slave（同步双写）：</strong>不存在数据问题，可用性高。但是代价较大，延迟略高</p>
<h6 id="两种consumer类型"><a href="#两种consumer类型" class="headerlink" title="两种consumer类型"></a>两种consumer类型</h6><p><strong>拉取型：</strong>consumer从broker主动拉取信息，批量拉取到信息启动消费</p>
<p><strong>推送型：</strong>设置一个监听器，由消费者向broker发送心跳维持长链接，如果有需要的消息就交给消费者消费</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/07/14/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/" data-id="ckifbjexw000ozknrflwr1vsu" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2020/07/18/Go%E8%AF%AD%E8%A8%80/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          工程实战
        
      </div>
    </a>
  
  
    <a href="/2020/07/13/%E4%B8%80%E8%87%B4%E6%80%A7%E7%AE%97%E6%B3%95/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title"></div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/12/07/cpu%E9%A3%99%E9%AB%98%E6%8E%92%E6%9F%A5/">(no title)</a>
          </li>
        
          <li>
            <a href="/2020/12/04/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95/">(no title)</a>
          </li>
        
          <li>
            <a href="/2020/07/29/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E5%AE%9E%E7%8E%B0%E6%96%B9%E5%BC%8F/">高并发相关技术</a>
          </li>
        
          <li>
            <a href="/2020/07/27/%E6%95%B0%E6%8D%AE%E5%BA%8F%E5%88%97%E5%8C%96%E6%96%B9%E6%A1%88/">(no title)</a>
          </li>
        
          <li>
            <a href="/2020/07/21/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F/">(no title)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>