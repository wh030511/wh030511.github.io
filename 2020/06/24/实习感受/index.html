<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>实习 | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="实习感受 字节跳动实习记录">
<meta property="og:type" content="article">
<meta property="og:title" content="实习">
<meta property="og:url" content="http://example.com/2020/06/24/%E5%AE%9E%E4%B9%A0%E6%84%9F%E5%8F%97/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="实习感受 字节跳动实习记录">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2020-06-24T05:41:03.471Z">
<meta property="article:modified_time" content="2020-07-20T03:11:13.933Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 5.2.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-实习感受" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/06/24/%E5%AE%9E%E4%B9%A0%E6%84%9F%E5%8F%97/" class="article-date">
  <time datetime="2020-06-24T05:41:03.471Z" itemprop="datePublished">2020-06-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      实习
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="实习感受"><a href="#实习感受" class="headerlink" title="实习感受"></a>实习感受</h2><blockquote>
<p>字节跳动实习记录</p>
</blockquote>
<a id="more"></a>

<h4 id="实习第一周"><a href="#实习第一周" class="headerlink" title="实习第一周"></a>实习第一周</h4><p>参加了L项目的需求评审，由产品经理向开发人员介绍该项目的服务人群，整体的运行逻辑等。刚开始很懵，懵懵懂懂的参加了会议，也不知道具体在说些什么。</p>
<p>mentor给我布置了熟悉业务的任务，所以开始看之前项目的代码，是用SpringBoot+SpringCloud框架搭的，由于不熟悉SpringBoot，所以还按照假期自己的学习节奏，按部就班的在b站看spring boot的学习视频，后来mentor让我给他看我看代码理解的业务逻辑，我就把学习boot的记录给他看，自然不能合格的。后来也没有继续参与之前项目的优化工作，而是参加到新的L项目的开发中去了。</p>
<p>在这周主要是搭建自己本地的开发环境，第一次使用mac，也是第一次接触在项目中协同开发，踩了很多坑，在git上也栽了很多跟头，也正因为如此，让我发散的去学习了git的原理，了解了ssh这样的应用层协议。第一次使用go语言，在go的包管理器go mod上撞了很多墙，现在已经可以较为熟练的使用go mod的各种命令了。</p>
<p>公司的代码仓库使用的是gitlab，来之前github我用的都没有很利索，见到gitlab还比较恐惧，在百度和别人的帮助下，找到了我们团队的项目，然后磕磕绊绊的使用git。</p>
<p>初入职场，一切都是陌生的，说实话，感觉自己很没用。</p>
<h4 id="实习第二周"><a href="#实习第二周" class="headerlink" title="实习第二周"></a>实习第二周</h4><p>也没有敲代码，而是跟着做L项目的技术方案，L项目我们团队一共负责两个服务，一个是读卷服务，一个是阅卷服务（没错这是一个微服务项目，而且北京上海无锡三地协同开发）。我是参与到读卷服务中来的，老大给同组的一个同事布置了任务，让我和他一起做，是根据产品PRD，梳理读卷项目所有的接口，然后完成thrift和proto接口文件。第一次接触对接口这样的概念，我还是按照学生的思维逻辑，先去了解了这都是些啥，然后学习了proto和thrift的语法，说实话，没啥语法好学的，有编程的底子，这些应该是一看就能会的。但是我总是觉得，可能会有一些要注意的细节，所以看完了相关的文档。proto和thrift是什么搞清楚了，怎么完成工作还是一头雾水，如何从PRD中梳理出接口呢？当时参与产品需求评审的时候，是当故事听了，所以去请教同事，可惜，他也不太会。这个任务最后基本没能完成，是老大自己写完的。</p>
<h4 id="实习第三周"><a href="#实习第三周" class="headerlink" title="实习第三周"></a>实习第三周</h4><p>项目开始开发了，负责前端页面需要的一些数据的后台实现，一共是六个查询接口。刚开始接到任务的时候还是挺开心的，觉得查询嘛，就是写sql查数据库就行了，于是兴冲冲的先去尝试了go连接数据库的方式，确实很简洁。然后准备写代码了，观摩了团队之前的代码，发现和java一样也分了很多层，从handler到logic到dal，在dal层使用了gorm框架，傻眼了，当初学习MyBaties的痛苦记忆历历在目，没办法，继续学吧。求助百度了解gorm框架，看完了文档发现公司在原gorm框架上又封装了一层，其实也没啥，就是传递了程序上下文，但当时就…好不容易了解了一个框架，你又来？就…挺秃然的。</p>
<p>开发接口差不多花了三天，一天完成两个接口，越做越发现其实都大同小异，CRUD嘛。也是在这个过程中，了解到了微服务项目中，如果要访问别的服务提供的数据，是通过rpc远程过程调用的，从这个点出发了解了相关的知识。</p>
<h4 id="实习第四周"><a href="#实习第四周" class="headerlink" title="实习第四周"></a>实习第四周</h4><p>开始自测代码了，由于是查询接口，所以想自己在本地建立一个数据库，往里面写一点数据来测试，但是建立好了数据库，却发现由于公司在原来的gorm框架上封装了一层，所以在代码库的各个犄角旮旯都有init函数干扰了我查询数据库。询问同事，说把项目部署到开发机上就可以了。当时我就：啊？这？非常困惑，也不太好意思一直打扰别人，因为大家的工作还都挺忙的。就自己倒腾了。后来理解了，开发机就是虚拟机，这个虚拟机可能是在某个特殊的网段中，可以访问到在BOE环境下初始化的数据库，而将代码部署到开发机上，其实也就是把项目文件发送到另一台主机上而已，这个过程是通过SMTP传输的，在GoLand上就集成了开发机选项。当然，在开发机上也要部署好开发环境，就是git和go这些，由于公司的命名规范，所以GoRoot一定要在/opt/tiger目录下。当然，在搭建开发机上的git的时候也一堆问题，git，一生之敌！</p>
<p>然后就想使用go test测试代码，发现不得行，是因为BOE上的数据库用kerberos加密以确保安全，在访问之前要先kinit验证身份，终于！跑通了，出现了PASS的字样。</p>
<p>兴冲冲的向老大报告，老大问我devops成功了吗？我：？？？？啥？这又是啥？没说的，继续去了解，公司的devops平台就是一个更加强大的CICD平台，通过建立流水线的方式可以将项目部署起来，然后用postman可以测试从url访问能否成功。但是我编写的项目是服务端的代码，直接向前端暴露的访问的代码是另一个项目mark_paper_api，就是由proto接口文件定义的项目。所以要在这个项目里使用rpc调用服务端项目read_upload，当然，也要编写逻辑。</p>
<p>于是clone了该项目，写逻辑，部署项目，在此期间经历了代码review，改掉了会造成空指针的代码。</p>
<p>将两个项目都以流水线的方式部署到devops，使用postman，访问url，成功跑通。很开心！</p>
<h4 id="实习第五周"><a href="#实习第五周" class="headerlink" title="实习第五周"></a>实习第五周</h4><p>代码通是通了，没数据啊，所以申请了相关数据库的访问权限，这样就能在字节云BOE上使用SQL查询器直接写sql查数据，然后写到单测代码里验证了。测试结果显示，所有调用了rpc的接口，都显示无数据，这是当然的。</p>
<p>然后遇到了项目需求变更，之前调用的user服务的rpc都不能使用了，要用组织关系那边的服务去获取数据，而组织关系需要传递两个必须的参数，这两个参数由前端传递，所以没有办法，要修改thrift和proto，非常不幸的重写代码，在编写新代码的过程中，与接口的提供人对接，询问接口的使用规则，领悟了什么是微服务。</p>
<p>在此期间，也完成了老大布置的和前端对错误代码的工作。</p>
<p>改完thriftidl和protobuf后，分别使用不同的工具重新生成对应的服务端项目和api服务的代码。用kx工具更新服务端项目很成功，在服务端项目中成功添加在thrift中新增的request或者response字段，如果想要让大家都使用更新后thrift，要在gocommon项目目录下使用kx工具，然后将更改的gocommon项目提交到master分支。</p>
<p>但是用gen.sh工具更新api服务一直不成功，是因为要成功将变化提交到master分支，才能生成新的相关项目的httpidl–pbgen，而在api服务中，相关的request和response都是依赖httpidl-pbgen的，我尝试发送mr请求，失败了（httpidl涉及的项目太多了，我也怕我改了什么不该改的，合到master分支太恐怖了，可以理解，交给有经验的同事去做吧）。</p>
<h4 id="实习第六周"><a href="#实习第六周" class="headerlink" title="实习第六周"></a>实习第六周</h4><p>老老实实的测试服务端项目代码，mock数据（在调用rpc的代码中直接写死数据），测试接口出现数据。然后经过了部门老大对我们组的代码review，重构代码。</p>
<p>将并行查询数据库的代码抽出来，使用goroutine提高查询效率；</p>
<p>将错误日志详细打印，如果有多个参数，在日志中分别打印出参数的值，便于后期排查；</p>
<p>将循环查询数据库的语句以in的方式改写，减少IO，提高查询效率。</p>
<p>组织关系服务提供了简单的数据，删除mock数据的代码，测试rpc接口调用，成功。</p>
<h4 id="实习第七周"><a href="#实习第七周" class="headerlink" title="实习第七周"></a>实习第七周</h4><p>端午放假回来，这周的主要任务就是开发自测全部完毕，通过冒烟测试。</p>
<p>出现了许多问题，诸如：更新批次状态时数据库字段没有更新，需要自己想办法更新，但是由于对业务的不熟悉，没能想出比较符合预期的方法，这个字段的更新任务最终是由老大完成的，其逻辑是这样的，在开始扫描前和识别结束后分别加上一个redis字段来计数，识别结束后比对这两个计数器，如果相同说明批次结束，就将read_batch表中的批次状态字段变更。这个方法会出一个小概率的问题，就是缓存失效怎么办。解决的缓存重生的逻辑是，如果缓存失效，就分别从原图表和识别结束后的异常表和正常表去查数据，做缓存重生。</p>
<p>还有一些其他问题，如接口响应超时了，是由于channel阻塞住了，所以警醒了自己使用channel一定要小心，从channel中拿数据的时候要判断有没有数据，如果没有就不能拿，否则一定会阻塞在这里，查问题也很难查到。</p>
<p>这周是非常忙碌的一周，由于前期埋下的坑，所以这周要一一解决，包括数据差不到，查到的数据与预期的不符，接口的响应时间太慢等等。一一的去打日志找bug，加缓存，检查代码逻辑，重新与上下游对接口等等。</p>
<h4 id="实习第八周"><a href="#实习第八周" class="headerlink" title="实习第八周"></a>实习第八周</h4><p>这周全面进入测试阶段，由于之前对业务的不熟悉，导致结算页的数据并不十分契合产品的prd，所以产生了很多bug。一方面在修改bug，一方面逐渐将自己的工作移交给校招的同事，然后负责她之前负责的扫描管理后台的需求。</p>
<p>在完成这个需求的时候，也产生了许多思考，比如，管理后台提供删除批次和删除图片的功能，而由于服务端有许多表，这些表之间都存在一定的关联关系，所以删除批次或者删除图像的时候另外一些表的某些记录也需要更新，大概是有四五张表。显然，应该保持一致性，即：要么都删除，要么都不删除。于是就需要使用一个事物来做这些操作。</p>
<p>在删除图像的时候，要更新批次表中的scan_count字段（将该字段的值减去删除的图像数量作为新值），显然是可以通过两次查询表，在go中做减法，然后更新来解决问题的。但是sql本身是支持运算的，于是我去查找了gorm框架如何拼接带有运算的sql（使用gorm.expr即可）。在这个过程中，加入了自己的思考，一定程度上提高了效率。</p>
<p>还有就是在代码中接入公司权限校验平台kani，其过程写成了另一个文档。</p>
<h4 id="实习第九周"><a href="#实习第九周" class="headerlink" title="实习第九周"></a>实习第九周</h4><p>任务越来越少了，整体的大流程基本跑通，整个服务在有条不紊的测试中，这周主要就是在管理后台上加了两个接口，一个结束批次，一个重新识别。被一个弱智错误造成的代码困扰了两天多：在api服务中，初始化context使用的应该是kitty中的上下文，而不是context自带的background，所以导致从api进入gocommon的时候，找不到映射的方法，简单的介绍一下排查问题的过程：</p>
<p>回退api和rpc版本，重新生成，失败。</p>
<p>重新定义pb和thrift，没区别，放弃。</p>
<p>在另一个api服务中定义这个接口，复制代码，问题重现，排除api的错误，认为是rpc的问题。</p>
<p>编写单元测试，从handler到dal层可以跑通，rpc没问题，崩溃。</p>
<p>在能跑通的api方法里，将调用rpc的部分写死，调用本来跑不通的方法，成功，排除gocommon的问题。</p>
<p>往上排查，找到最开始初始化上下文的地方，发现不一致，找到问题。</p>
<p>一些奇怪的bug，总是由弱智错误造成的……</p>
<p>这周尽力了转正答辩，应该是通过了，开心。但是转正答辩的时候表现一般，所以下决心要好好学习，打算在大四一年把基础打牢。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/06/24/%E5%AE%9E%E4%B9%A0%E6%84%9F%E5%8F%97/" data-id="ckifb2s4k000h6jnr0fyt5xa9" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2020/07/12/kani/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          (no title)
        
      </div>
    </a>
  
  
    <a href="/2020/06/04/gorm/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title"></div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/12/07/cpu%E9%A3%99%E9%AB%98%E6%8E%92%E6%9F%A5/">(no title)</a>
          </li>
        
          <li>
            <a href="/2020/12/04/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95/">(no title)</a>
          </li>
        
          <li>
            <a href="/2020/07/29/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E5%AE%9E%E7%8E%B0%E6%96%B9%E5%BC%8F/">高并发相关技术</a>
          </li>
        
          <li>
            <a href="/2020/07/27/%E6%95%B0%E6%8D%AE%E5%BA%8F%E5%88%97%E5%8C%96%E6%96%B9%E6%A1%88/">(no title)</a>
          </li>
        
          <li>
            <a href="/2020/07/21/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F/">(no title)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>